textures = { }

function onStartResNoHave()
    downloadFile("me/stringdev/mstgroupsystem/assets/images/background.png_encrypt")
    downloadFile("me/stringdev/mstgroupsystem/assets/images/card.png_encrypt")
    downloadFile("me/stringdev/mstgroupsystem/assets/images/card2.png_encrypt")
    downloadFile("me/stringdev/mstgroupsystem/assets/images/icons/econ.png_encrypt")
    downloadFile("me/stringdev/mstgroupsystem/assets/images/icons/home.png_encrypt")
    downloadFile("me/stringdev/mstgroupsystem/assets/images/icons/logs.png_encrypt")
    downloadFile("me/stringdev/mstgroupsystem/assets/images/icons/members.png_encrypt")
    downloadFile("me/stringdev/mstgroupsystem/assets/images/icons/money.png_encrypt")
    downloadFile("me/stringdev/mstgroupsystem/assets/images/icons/visible.png_encrypt")
    downloadFile("me/stringdev/mstgroupsystem/assets/images/icons/novisible.png_encrypt")
    downloadFile("me/stringdev/mstgroupsystem/assets/images/icons/user.png_encrypt")
    downloadFile("me/stringdev/mstgroupsystem/assets/images/icons/usericon.png_encrypt")
    downloadFile("me/stringdev/mstgroupsystem/assets/images/icons/leave.png_encrypt")
    downloadFile("me/stringdev/mstgroupsystem/assets/images/icons/trash.png_encrypt")
end
addEventHandler("onClientResourceStart", getRootElement(), onStartResNoHave)

addEventHandler("onClientFileDownloadComplete", getRootElement(), function(file, success)
    if not (source == resourceRoot) then return end
    if not (success) then return end

    decryptFiles(file, "M1ST1CST0R3T0P")
end)

function decryptFiles(nameFile, password)
    local fileName = nameFile:gsub("png_encrypt", "png")
    local file = fileExists(fileName)
    if (file) then
        fileDelete(file)
    end
    
    local compiledStr
    local compiledFile = fileOpen(nameFile)
    if (compiledFile) then
        compiledStr = fileRead(compiledFile, fileGetSize(compiledFile))
        fileClose(compiledFile)
    end
    
    local file = fileCreate(fileName) or fileOpen(fileName)
    if (file) then
        decodeString("tea", compiledStr, {key=password},
        function(str)
                fileWrite(file, str)
                fileClose(file)
                textures[nameFile] = dxCreateTexture(str, "argb", true, "clamp")
                fileDelete(fileName)
            end
        )
    end

    return true
end